{
  "name": "gin",
  "tagline": "Distributed Workflow Tool",
  "body": "gin\r\n==\r\n\r\ngin is a simple distributed workflow engine, including task brokerage and staefulness, written in go.\r\n\r\nIt contains three components; of which there may be a multitude of instances:\r\n\r\n* One or more master Nodes\r\n* One or more job Nodes\r\n* One or more API Nodes\r\n\r\nAnd a couple of dependencies:\r\n\r\n* RabbitMQ\r\n* Redis\r\n\r\nA `workflow` is made up of `tasks` and `variables` and collated in a `runner` which stores state via a simple state machine.\r\n\r\nMaster and Job nodes may be run right out of the box. Job nodes, however, come with very few configured jobs out the box and so it becomes simpler to create a project which initialises a JobManager object.\r\n\r\n| who       | what |\r\n|-----------|------|\r\n| dockerhub | https://hub.docker.com/r/gincorp/gin/   |\r\n| circleci  | https://circleci.com/gh/gincorp/gin   |\r\n| licence   | MIT   |\r\n\r\n\r\n\r\nMaster Nodes\r\n--\r\n\r\nMaster nodes are run with:\r\n\r\n```\r\n$ gin -mode master -amqp amqp://guest:guest@localhost/vhost -redis redis://localhost:6379/0\r\n```\r\n\r\nOr via docker:\r\n\r\n```\r\n$ docker run -p8080:8080 jspc/gin -mode master -amqp amqp://guest:guest@localhost/vhost -redis redis://localhost:6379/0\r\n```\r\n\r\nMaster nodes compile and broker workflow tasks via a runner.\r\n\r\nJob Nodes\r\n--\r\n\r\nJob nodes are run with:\r\n\r\n```\r\n$ gin -mode job -amqp amqp://guest:guest@localhost/vhost\r\n```\r\n\r\nOr via docker:\r\n\r\n```\r\n$ docker run -p8080:8080 jspc/gin -mode job -amqp amqp://guest:guest@localhost/vhost\r\n```\r\n\r\nJob nodes receive formatted tasks via rabbitmq, execute the task and return outputs and metadata.\r\n\r\nAPI Nodes\r\n--\r\n\r\nAPI nodes are run with:\r\n\r\n```\r\n$ gin -mode job -amqp amqp://guest:guest@localhost/vhost -redis redis://localhost:6379/0 -host 0.0.0.0 -port 8080\r\n```\r\n\r\nOr via docker:\r\n\r\n```\r\n$ docker run -p8080:8080 jspc/gin -mode job -amqp amqp://guest:guest@localhost/vhost -redis redis://localhost:6379/ -host 0.0.0.0 -port 8080\r\n```\r\n\r\nAPI nodes provide an interface to the engine; for starting and configuring workflows.\r\n\r\n**Note**: There is no auth-n, auth-z nor much of anything in front of the API. You should either use an API gateway or router in front of the tool. It probably wont be included in this project; it seems out of scope.\r\n\r\n\r\nArchitecture\r\n--\r\n\r\n![naive gin architecture diagram](img/gin.png)\r\n\r\n\r\nWorkflows\r\n--\r\n\r\nA workflow definition looks like:\r\n\r\n```json\r\n{\r\n    \"name\": \"do stuff\",\r\n    \"variables\": {\r\n        \"echo_url\": \"http://172.17.0.1:8000/some-endpoint\",\r\n        \"content_type\": \"application/data\"\r\n    },\r\n    \"steps\": [{\r\n        \"name\": \"Test Stuff\",\r\n        \"type\": \"post-to-web\",\r\n        \"context\": {\r\n            \"url\": \"{{.Defaults.echo_url}}\",\r\n            \"content-type\": \"{{.Defaults.content_type}}\",\r\n            \"data\": \"foo=bar\"\r\n        },\r\n        \"register\": \"echo_data\"\r\n    }, {\r\n        \"name\": \"Templatery Stuff\",\r\n        \"type\": \"log\",\r\n        \"context\": {\r\n            \"message\": \"{{.echo_data.Host}}\"\r\n        },\r\n        \"register\": \"something\"\r\n    }]\r\n}\r\n```\r\n\r\nThe initial set of variables are accessible via the `.Defaults` key in context templates. These templates allow:\r\n\r\n* DRYing up of step data\r\n* The ability to rely on the output of a previous step\r\n\r\nTo access the output of a previous step, one must `register` the step with a unique name. This will be recognisable by ansible users, for example (in fact: thats where I stole the idea).\r\n\r\nA workflow is kicked off via an api call:\r\n\r\n```bash\r\ncurl -X POST -d '{\"Name\": \"nontrivial workflow\", \"Variables\":{\"foo\": \"bar\"} }' localhost:8080/wf/\r\n```\r\n\r\nThe object `Variables` may be omitted: this is useful for data which is not known until runtime, and is made availabled via the `.Rumtime` key in context templates; in an identical fashion to how `.Defaults` works.\r\n\r\nThe request mints, and returns, a UUID. A workflow runner is attached to this uuid. This uuid can be used to view the status of a workflow; like the follow failed workflow:\r\n\r\n```bash\r\n$ curl localhost:8080/wf/7423bbb5-b020-4410-91b6-a5e2754e6a47\r\n```\r\n\r\nReturning:\r\n\r\n```json\r\n{\r\n  \"EndTime\": \"2016-12-14T11:40:54.367619801Z\",\r\n  \"ErrorMessage\": \"Step \\\"Test Stuff\\\" failed. See below\",\r\n  \"Last\": \"Test Stuff\",\r\n  \"StartTime\": \"2016-12-14T11:34:32.703863903Z\",\r\n  \"State\": \"failed\",\r\n  \"UUID\": \"7423bbb5-b020-4410-91b6-a5e2754e6a47\",\r\n  \"Variables\": {\r\n    \"Defaults\": {\r\n      \"content_type\": \"application/data\",\r\n      \"echo_url\": \"http://172.17.0.1:8000/some-endpoint\"\r\n    }\r\n  },\r\n  \"Workflow\": {\r\n    \"Name\": \"do stuff\",\r\n    \"Steps\": [\r\n      {\r\n        \"Context\": {\r\n          \"content-type\": \"application/data\",\r\n          \"data\": \"foo=bar\",\r\n          \"url\": \"http://172.17.0.1:8000/some-endpoint\"\r\n        },\r\n        \"Duration\": \"2 ms\",\r\n        \"End\": \"2016-12-14T11:36:06\",\r\n        \"ErrorMessage\": \"Post http://172.17.0.1:8000/some-endpoint: dial tcp 172.17.0.1:8000: getsockopt: connection refused\",\r\n        \"Failed\": true,\r\n        \"Name\": \"Test Stuff\",\r\n        \"Register\": \"echo_data\",\r\n        \"Start\": \"2016-12-14T11:36:06\",\r\n        \"Type\": \"post-to-web\",\r\n        \"UUID\": \"\"\r\n      },\r\n      {\r\n        \"Context\": {\r\n          \"message\": \"{{.echo_data.Host}}\"\r\n        },\r\n        \"Duration\": \"\",\r\n        \"End\": \"\",\r\n        \"ErrorMessage\": \"\",\r\n        \"Failed\": false,\r\n        \"Name\": \"Templatery Stuff\",\r\n        \"Register\": \"something\",\r\n        \"Start\": \"\",\r\n        \"Type\": \"log\",\r\n        \"UUID\": \"\"\r\n      }\r\n    ],\r\n    \"Variables\": {\r\n      \"content_type\": \"application/data\",\r\n      \"echo_url\": \"http://172.17.0.1:8000/some-endpoint\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nHere we see the first step has been compiled, yet the second step has npt. This is because a step is compiled right before it is run, to allow it access to the latest data. We can also see the runner has failed; it could not get access to a service and thus bombs out.\r\n\r\n\r\nLicence\r\n--\r\n\r\nMIT License\r\n\r\nCopyright (c) 2016 jspc\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}